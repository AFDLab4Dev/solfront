<!DOCTYPE html>
<head>
   <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
   <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

   <style>

      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }

      .legend {
          padding: 0px 0px;
          font: 10px sans-serif;
          background: white;
          background: rgba(255,255,255,0.8);
          box-shadow: 0 0 15px rgba(0,0,0,0.2);
          border-radius: 5px;
      }

      .key path {
        display: none;
      }

	#map {
		width: 100%;
		height: 100%;
		}

	#location  {
		position: absolute;
		top: 0px;
		z-index: 7;
		right: 0px;
		font-size: 18;
		color: black;
		text-align: right;
		background-color: white;
		opacity: 0.8;
		padding: 10px 10px;
	}

	#logo  {
		position: absolute;
		z-index: 7;
		bottom: 0px;
		left: 0px;
	}

   </style>
</head>

<body>
   <div id="map" style=""></div>
   <div id="location"></div>
   <div id="logo"><img src="opensolarmap.png" width=25%></div>

   <script>
      var building;

      queue()
          .defer(d3.json, 'http://stmaur.cquest.org:12345/building')
          .await(gotBuilding);

      function gotBuilding(error, gjson_1) {
		building = gjson_1;
		queue()
			.defer(d3.json, 'http://api-adresse.data.gouv.fr/reverse/?lon='+gjson_1.properties.lon+'&lat='+gjson_1.properties.lat+'&type=street')
			.await(makeMap);
      }


      function onEachFeature(feature, layer) {
          // does this feature have a property named popupContent?
          if (feature.properties && feature.properties.popupContent) {
              layer.bindPopup(feature.properties.popupContent);
              }
          };

<<<<<<< HEAD
      function makeMap(error, geocode) {
=======
      function makeMap(error, gjson_1) {
>>>>>>> 62d66e0107f47302f98b943fc8a2ddecc255dc42

          function matchKey(datapoint, key_variable){
              if (typeof key_variable[0][datapoint] === 'undefined') {
                  return null;
              }
              else {
                  return parseFloat(key_variable[0][datapoint]);
              };
          };      

<<<<<<< HEAD
          var map = L.map('map').setView([building.properties.lat, building.properties.lon], 19);
=======
          var map = L.map('map').setView([gjson_1.properties.lat, gjson_1.properties.lon], 19);
>>>>>>> 62d66e0107f47302f98b943fc8a2ddecc255dc42

          L.tileLayer('http://{s}.tiles.mapbox.com/v4/openstreetmap.map-inh7ifmo/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoib3BlbnN0cmVldG1hcCIsImEiOiJncjlmd0t3In0.DmZsIeOW-3x-C5eX-wAqTw', {
              maxZoom: 19,
              minZoom: 1,
              attribution: 'Imagery &copy; <a href="https://www.mapbox.com/satellite/">Mapbox/DigitalGlobe</a> - Map data &copy; <a href="http://osm.org/copyright">OpenStreetMap contributors</a>'
          }).addTo(map);

<<<<<<< HEAD
      	var mark = L.circle([building.properties.lat, building.properties.lon], building.properties.radius*1.2).addTo(map);

		d3.select("#location").text(geocode.features[0].properties.label);
=======
          
          function style_1(feature) {
    return {
        fillColor: 'blue',
        weight: 1,
        opacity: 1,
        color: 'black',
        fillOpacity: 0.6
    };
}
>>>>>>> 62d66e0107f47302f98b943fc8a2ddecc255dc42

      	var mark = L.circle([gjson_1.properties.lat, gjson_1.properties.lon], gjson_1.properties.radius*1.5).addTo(map);
      };
   </script>
</body>
